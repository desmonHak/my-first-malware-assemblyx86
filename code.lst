     1                                  [bits 32]
     2                                  
     3                                  ; OF = 1 
     4                                  %define JumpIfOverflow(symbol) jo symbol
     5                                  
     6                                  ; OF = 0 
     7                                  %define JumpIfNotOverflow(symbol) jno symbol
     8                                  
     9                                  ; SF = 1 
    10                                  %define JumpIfSign(symbol) js symbol
    11                                  
    12                                  ; SF = 0 
    13                                  %define JumpIfNotSign(symbol) jns symbol
    14                                  
    15                                  ; ZF = 1 	 
    16                                  %define JumpIfEqual(symbol) je symbol
    17                                  
    18                                  ;ZF = 0
    19                                  %define JumpIfNotEqual(symbol) jne symbol
    20                                  
    21                                  ; ZF = 1 	 
    22                                  %define JumpIfZero(symbol) jz symbol
    23                                  
    24                                  ; ZF = 0 
    25                                  %define JumpIfNotZero(symbol) jnz symbol
    26                                  
    27                                  %define STD_OUTPUT_HANDLE -11
    28                                  %define true 1
    29                                  %define false 0
    30                                  
    31                                  section .bss
    32                                  
    33                                  section .text
    34                                      global _WinMain@16           ; Declaracion de la funcion principal del programa
    35                                      extern _GetStdHandle@4       ; Declaracion de la funcion GetStdHandle de Windows
    36                                      extern _WriteFile@20         ; Declaracion de la funcion WriteFile de Windows
    37                                      extern _ExitProcess@4        ; Declaracion de la funcion ExitProcess de Windows
    38                                  
    39                                  cpuid_:
    40 00000000 55                          push ebp
    41 00000001 89E5                        mov ebp, esp
    42                                  
    43                                      ; "GenuineIntel" = 0x47,0x65,0x6e,0x75,0x69,0x6e,0x65,0x49,0x6e,0x74,0x65,0x6c
    44                                  
    45 00000003 60                          pusha
    46 00000004 31C0                        xor eax, eax ; EAX = 0
    47 00000006 0FA2                        cpuid ; cpuid(EAX = 0) -> return char*(ebx, edx, ecx)
    48 00000008 81FB47656E75                cmp ebx, 0x756e6547 ; Genu(0x47656e75) -> uneG(0x756e6547)
    49 0000000E 61                          popa
    50 0000000F 7502                        JumpIfNotEqual(.next_if)
    51 00000011 740A                        JumpIfEqual(._thisIntel)
    52                                  
    53                                      .next_if:
    54 00000013 81FB41757468                    cmp ebx, 0x68747541 ; Auth(0x41757468) -> htuA(0x68747541)
    55 00000019 741A                            JumpIfEqual(._thisAMD)
    56 0000001B 7530                            JumpIfNotEqual(._err)
    57                                  
    58                                      
    59                                      ._thisIntel:   
    60                                      
    61                                          ; El procesador es Intel
    62 0000001D 6A00                            push 0 
    63 0000001F 8D442404                        lea eax, [esp+4]             ; Calcula la direccion del Parametro lpNumberOfBytesWritten
    64 00000023 50                              push eax                     ; Parametro: lpNumberOfBytesWritten
    65 00000024 6A0E                            push dword lengthprocesadorIntel; Parametro: nNumberOfBytesToWrite (longitud del mensaje)
    66 00000026 68[0F000000]                    push procesadorIntel                 ; Parametro: lpBuffer (puntero al mensaje)
    67 0000002B 53                              push ebx                     ; Parametro: hFile (identificador de la salida estándar)
    68 0000002C E8(00000000)                    call _WriteFile@20
    69 00000031 31C0                            xor eax, eax
    70 00000033 EB1C                            jmp ._return
    71                                  
    72                                      ._thisAMD:   
    73                                          ; El procesador es AMD
    74 00000035 6A00                            push 0 
    75 00000037 8D442404                        lea eax, [esp+4]             ; Calcula la direccion del Parametro lpNumberOfBytesWritten
    76 0000003B 50                              push eax                     ; Parametro: lpNumberOfBytesWritten
    77 0000003C 6A0E                            push dword lengthprocesadorIntel; Parametro: nNumberOfBytesToWrite (longitud del mensaje)
    78 0000003E 68[1D000000]                    push procesadorAMD                 ; Parametro: lpBuffer (puntero al mensaje)
    79 00000043 53                              push ebx                     ; Parametro: hFile (identificador de la salida estándar)
    80 00000044 E8(00000000)                    call _WriteFile@20
    81 00000049 31C0                            xor eax, eax
    82 0000004B EB04                            jmp ._return
    83                                  
    84                                      ._err:
    85                                          ; eax = -1
    86 0000004D 31C0                            xor eax, eax
    87 0000004F F7D0                            not eax
    88                                          ; return -1
    89                                  
    90                                      ._return:
    91 00000051 89EC                            mov esp, ebp
    92 00000053 5D                              pop ebp
    93 00000054 C3                              ret
    94                                          ; return ?
    95                                  
    96                                  
    97                                  _WinMain@16:
    98                                  
    99                                      ; Reservar espacio en la pila para la variable local
   100 00000055 83EC04                      sub esp, 4
   101                                  
   102                                      ; Obtener el identificador de la salida estándar
   103                                      ; HANDLE ebx = GetStdHandle(DWORD STD_OUTPUT_HANDLE)
   104 00000058 6AF5                        push STD_OUTPUT_HANDLE       ; Parametro: STD_OUTPUT_HANDLE (-11)
   105 0000005A E8(00000000)                call _GetStdHandle@4         ; Llama a la funcion GetStdHandle para obtener el identificador de la salida estándar
   106 0000005F 89C3                        mov ebx, eax                 ; Almacena el identificador de la salida estándar en ebx
   107                                  
   108 00000061 E89AFFFFFF                  call cpuid_
   109                                  
   110                                      ;cli ; desactivar interupciones IF = 0
   111                                  
   112                                      ; Escribir el mensaje en la salida estándar
   113                                      ; BOOL WriteFile(
   114                                      ;   [in]                HANDLE       hFile,
   115                                      ;   [in]                LPCVOID      lpBuffer,
   116                                      ;   [in]                DWORD        nNumberOfBytesToWrite,
   117                                      ;   [out, optional]     LPDWORD      lpNumberOfBytesWritten,
   118                                      ;   [in, out, optional] LPOVERLAPPED lpOverlapped
   119                                      ; );
   120                                      ; WriteFile(ebx, message, lengthmessage, eax, 0)    
   121 00000066 EB00                        jmp ._a
   122                                      ;db 0x90, 0xaf, 0x11, 0xa0, 0x90, 0x90, 0xaf, 0x11, 0xa0, 0x90
   123                                      ._a:
   124 00000068 6A00                        push 0                       ; Parametro: lpOverlapped (0)
   125                                  
   126 0000006A 8D442404                    lea eax, [esp+4]             ; Calcula la direccion del Parametro lpNumberOfBytesWritten
   127 0000006E 50                          push eax                     ; Parametro: lpNumberOfBytesWritten
   128 0000006F 6A0F                        push dword lengthmessage     ; Parametro: nNumberOfBytesToWrite (longitud del mensaje)
   129 00000071 68[00000000]                push message                 ; Parametro: lpBuffer (puntero al mensaje)
   130 00000076 53                          push ebx                     ; Parametro: hFile (identificador de la salida estándar)
   131                                  
   132                                      ;times 5 dw 0xcd10
   133 00000077 EB00                        jmp ._b
   134                                      ._b:
   135                                      ;sti ; activar interupciones IF = 1
   136 00000079 E8(00000000)                call _WriteFile@20           ; Llama a la funcion WriteFile para escribir el mensaje en la consola
   137                                      ;times 2 db 0x90
   138                                  
   139                                      ; Salir del programa
   140                                      ; ExitProcess(0)
   141 0000007E 6A00                        push 0                       ; Parametro: exitCode (0)
   142 00000080 E8(00000000)                call _ExitProcess@4          ; Llama a la funcion ExitProcess para terminar el programa
   143                                  
   144                                  
   145                                  section .data
   146 00000000 48656C6C6F2C20576F-         message db 'Hello, World!', 0xa, 0x0  ; Definición del mensaje a mostrar en la consola
   146 00000009 726C64210A00       
   147                                      lengthmessage: equ $-message
   148                                  
   149 0000000F 47656E75696E65496E-         procesadorIntel db "GenuineIntel", 0xa, 0x0
   149 00000018 74656C0A00         
   150                                      lengthprocesadorIntel: equ $-procesadorIntel
   151 0000001D 41757468656E746963-         procesadorAMD   db "AuthenticAMD", 0xa, 0x0
   151 00000026 414D440A00         
   152                                      ;lengthprocesadorAMD: equ $-procesadorAMD
   153                                  
   154                                  ;times 510 -( $ - $$ ) db 0
